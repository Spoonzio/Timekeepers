webpackJsonp([0],{"/GvF":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("Xxa5"),o=r.n(a),s=r("exGp"),n=r.n(s),i={name:"Login",data:function(){return{user:{},search:"",token:"",dialogLoading:!1,loading:!0,employees:[],selectedEmployees:[],checkedEmployeeObj:{},selectedProject:{},showEmployeeList:!1,pagination:{currentPage:1,currentSize:20,sizes:[20,40,60,80,100],total:0},projectData:[],multipleSelection:[],isPM:!1,isPA:!1,isSupervisor:!1}},methods:{toggleSelection:function(e){var t=this;e?e.forEach(function(e){t.$refs.multipleTable.toggleRowSelection(e)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(e){this.multipleSelection=e},handleSizeChange:function(e){this.size=e},handleCurrentChange:function(e){console.log("current page: "+e)},handleEmployeeList:function(e,t){var r=this;return n()(o.a.mark(function a(){var s,n,i;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return r.loading=!0,a.prev=1,a.next=4,r.$axios({method:"GET",url:r.$constants.projectUrl+"/"+t.projectId+"/"+t.workPackageId+"/parentEmployees",headers:{token:r.token},params:{page:r.page,size:r.size}});case 4:if(s=a.sent,r.loading=!1,0==s.data.code){a.next=9;break}return r.$message.error(s.data.message),a.abrupt("return");case 9:console.log(t),r.selectedEmployees=s.data.data,a.t0=o.a.keys(r.selectedEmployees);case 12:if((a.t1=a.t0()).done){a.next=26;break}n=a.t1.value,r.$set(r.selectedEmployees[n],"inProject",!1),"Administrator"==r.user.role?r.$set(r.selectedEmployees[n],"isSupervised",!0):r.selectedEmployees[n].supervisor?t.parentWorkPackageId||r.selectedEmployees[n].supervisor.employeeId!=r.user.employeeId?t.parentWorkPackageId&&r.isPM?r.$set(r.selectedEmployees[n],"isSupervised",!0):r.$set(r.selectedEmployees[n],"isSupervised",!1):r.$set(r.selectedEmployees[n],"isSupervised",!0):r.$set(r.selectedEmployees[n],"isSupervised",!1),a.t2=o.a.keys(e);case 17:if((a.t3=a.t2()).done){a.next=24;break}if(i=a.t3.value,r.selectedEmployees[n].employeeId!=e[i].employeeId){a.next=22;break}return r.$set(r.selectedEmployees[n],"inProject",!0),a.abrupt("break",24);case 22:a.next=17;break;case 24:a.next=12;break;case 26:r.selectedProject=t,r.showEmployeeList=!0,a.next=34;break;case 30:a.prev=30,a.t4=a.catch(1),r.$message.error(a.t4),console.log(a.t4);case 34:case"end":return a.stop()}},a,r,[[1,30]])}))()},handleAssign:function(){var e=this;return n()(o.a.mark(function t(){var r,a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e.dialogLoading=!0,r="/"+e.selectedProject.projectId+"/"+e.selectedProject.workPackageId+"/swap",a=[],e.selectedEmployees.forEach(function(e){e.inProject&&a.push(e.employeeId)}),0!=a.length){t.next=9;break}return e.dialogLoading=!1,e.$message.error("Need at least one employee for a project"),t.abrupt("return");case 9:return t.next=11,e.$axios({method:"PUT",url:e.$constants.projectUrl+r,headers:{token:e.token},data:{employees:a}});case 11:t.sent,e.initList(),e.dialogLoading=!1,e.showEmployeeList=!1,t.next=22;break;case 17:t.prev=17,t.t0=t.catch(0),e.$message.error(t.t0),e.dialogLoading=!1,console.log(t.t0);case 22:case"end":return t.stop()}},t,e,[[0,17]])}))()},load:function(e,t,r){console.log(e,t),setTimeout(function(){r([{id:31,date:"2016-05-01",name:"wangxiaohu"},{id:32,date:"2016-05-01",name:"wangxiaohu"}])},1e3)},initList:function(){var e=n()(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.token||(this.$message.error("Token expired"),this.$router.push("/")),e.prev=1,e.next=4,this.$axios({method:"GET",url:this.$constants.projectUrl,headers:{token:this.token}});case 4:if(t=e.sent,this.loading=!1,0==t.data.code){e.next=9;break}return this.$message.error(t.data.message),e.abrupt("return");case 9:return t.data.data.forEach(function(e){e.isOpen?e.isOpen="In Progress":e.isOpen="Close"}),this.projectData=t.data.data,this.pagination.total=this.projectData.length,this.DFS(this.projectData),e.next=15,this.$axios({method:"GET",url:this.$constants.usersUrl,headers:{token:this.token}});case 15:t=e.sent,this.employees=t.data.data.list,e.next=23;break;case 19:e.prev=19,e.t0=e.catch(1),this.$message.error(e.t0),console.log(e.t0);case 23:case"end":return e.stop()}},e,this,[[1,19]])}));return function(){return e.apply(this,arguments)}}(),DFS:function(e){if(null!=e)for(var t=0;t<e.length;t++)e[t].isOpen=e[t].open?"In Progress":"Closed",e[t].childWorkPackages&&this.DFS(e[t].childWorkPackages)}},mounted:function(){var e=this.$cookie.get("user");if(!e)return this.$message.error("Token expired"),void this.$router.push({name:"Login"});this.user=JSON.parse(e),this.token=JSON.parse(this.$cookie.get("user")).token,this.isPA=this.user.roles.includes("Project Assistant"),this.isPM=this.user.roles.includes("Project Manager"),this.isSupervisor=this.user.roles.includes("Supervisor"),this.initList()}},l={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[r("el-breadcrumb",{staticStyle:{"margin-bottom":"5px"},attrs:{separator:"/"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/dashboard/project"}}},[e._v("Project")]),e._v(" "),r("el-breadcrumb-item",[e._v("Project Management")])],1),e._v(" "),r("el-row",{staticStyle:{"margin-bottom":"5px","text-align":"right"}},[r("router-link",{attrs:{to:"editProject/0"}},["Administrator"==e.user.role?r("el-button",{attrs:{type:"primary"}},[e._v("New Project")]):e._e()],1)],1),e._v(" "),r("el-row",{style:"Administrator"==e.user.role?"":"margin-top: 40px;"},[r("el-table",{attrs:{data:e.projectData,"row-key":"workPackageId",border:"",lazy:"",load:e.load,"tree-props":{children:"childWorkPackages",hasChildren:"hasChildren"}}},[r("el-table-column",{attrs:{prop:"workPackageId",label:"Name",width:"200"}}),e._v(" "),r("el-table-column",{attrs:{prop:"manager",label:"Manager"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.manager?r("span",[e._v(e._s(t.row.manager))]):e._e()]}}])}),e._v(" "),"Administrator"==e.user.role||"Human Resource"==e.user.role||e.isPA||e.isPM?r("el-table-column",{attrs:{prop:"hourSpent",label:"Hour (Spent)"}}):e._e(),e._v(" "),r("el-table-column",{attrs:{prop:"isOpen",label:"Status"}}),e._v(" "),"Administrator"==e.user.role||"Human Resource"==e.user.role||e.isPA||e.isPM?r("el-table-column",{attrs:{prop:"costEstimate",label:"Cost (Est)"}}):e._e(),e._v(" "),"Administrator"==e.user.role||"Human Resource"==e.user.role||e.isPA||e.isPM||e.isSupervisor?r("el-table-column",{attrs:{prop:"employeeEntities.length",label:"Employee"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"text",size:"small"},on:{click:function(r){return e.handleEmployeeList(t.row.employeeEntities,t.row)}}},[e._v("\n            "+e._s(t.row.employeeEntities.length)+"\n          ")])]}}],null,!1,2125676132)}):e._e(),e._v(" "),"Administrator"==e.user.role||e.isPM||e.isPA?r("el-table-column",{attrs:{fixed:"right",label:"Action"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("router-link",{staticStyle:{"text-decoration":"none",color:"blue"},attrs:{to:{name:"EditProject",params:{id:t.row.projectId},query:{createWP:1,workPackageId:t.row.workPackageId}}}},[r("el-button",{attrs:{type:"text",size:"small"}},[e._v("New")])],1),e._v(" "),r("router-link",{staticStyle:{"text-decoration":"none",color:"blue"},attrs:{to:{name:"EditProject",params:{id:t.row.projectId},query:{workPackageId:t.row.workPackageId}}}},[r("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"text",size:"small"}},[e._v("Edit")])],1)]}}],null,!1,918071620)}):e._e()],1)],1),e._v(" "),r("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"center"},attrs:{"current-page":e.pagination.currentPage,"page-sizes":e.pagination.sizes,"page-size":e.pagination.currentSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pagination.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){return e.$set(e.pagination,"currentPage",t)},"update:current-page":function(t){return e.$set(e.pagination,"currentPage",t)}}}),e._v(" "),r("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}],attrs:{title:"Employee List",visible:e.showEmployeeList,"destroy-on-close":"","close-on-press-escape":"","lock-scroll":"","append-to-body":""},on:{"update:visible":function(t){e.showEmployeeList=t}}},[r("el-input",{staticStyle:{"margin-bottom":"5px",width:"100%"},attrs:{size:"normal",placeholder:"Type the first Name to search an employee"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),r("el-table",{attrs:{border:"","max-height":"300",data:e.selectedEmployees.filter(function(t){return!e.search||t.firstName.toLowerCase().includes(e.search.toLowerCase())})},on:{"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{property:"employeeId",label:"Employee ID"}}),e._v(" "),r("el-table-column",{attrs:{property:"lastName",label:"Last Name"}}),e._v(" "),r("el-table-column",{attrs:{property:"firstName",label:"First Name"}}),e._v(" "),r("el-table-column",{attrs:{property:"role",label:"Role"}}),e._v(" "),r("el-table-column",{attrs:{property:"",label:"Assigned","current-change":""},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isSupervised?r("el-checkbox",{model:{value:t.row.inProject,callback:function(r){e.$set(t.row,"inProject",r)},expression:"scope.row.inProject"}}):r("el-checkbox",{attrs:{disabled:""},model:{value:t.row.inProject,callback:function(r){e.$set(t.row,"inProject",r)},expression:"scope.row.inProject"}})]}}])})],1),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.showEmployeeList=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.handleAssign}},[e._v("Save")])],1)],1)],1)},staticRenderFns:[]};var c=r("VU/8")(i,l,!1,function(e){r("ZlcB")},"data-v-fef6c224",null);t.default=c.exports},ZlcB:function(e,t){}});